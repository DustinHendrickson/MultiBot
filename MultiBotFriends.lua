MultiBot.newFriends = function(pParent, pX, pY, pSize)	local frame = CreateFrame("Frame", nil, pParent)	frame.friends = {}	frame.classes = {}	frame.index = {}		frame.button = nil	frame.select = nil	frame.browse = nil		frame.parent = pParent	frame.size = pSize		frame:SetPoint("BOTTOMRIGHT", pX, pY)	frame:SetSize(pSize, pSize)	frame:Show()		-- ADD --		frame.addFriend = function(pName, pClass, pIndex)		if(frame.friends[pName] == nil) then frame.friends[pName] = MultiBot.newFriend(frame, pName, pClass, 0, (frame.size + 2) * pIndex, frame.size) end		return frame.friends[pName]	end		-- SET --		frame.setButton = function(pConfig, pStrate)		if(frame.button ~= nil) then frame.button:Hide() end		frame.button = MultiBot.newDouble(frame, 0, 0, pConfig, pStrate)		return frame.button	end		frame.setState = function(pState)		frame.button.setState(pState)	end		frame.setFriends = function()		local tIndex = 0				frame.limit = GetNumFriends()		frame.from = 1		frame.to = 10				-- Supportet limit of Friends is 50 in the Client 3.3.5a		if(frame.limit > 50) then frame.limit = 50 end				for i = 1, frame.limit do			local tName, tLevel, tClass = GetFriendInfo(i)			local tTemp = string.sub(string.lower(tClass), 1, 1) .. string.sub(string.lower(tClass), 4, 4)						-- Mapping German and English localisation of Classes			if(tTemp == "di") then tClass = "Druid" end			if(tTemp == "he" or tTemp == "wl") then tClass = "Warlock" end			if(tTemp == "jg" or tTemp == "ht") then tClass = "Hunter" end			if(tTemp == "ke" or tTemp == "wr") then tClass = "Warrior" end			if(tTemp == "mi" or tTemp == "me") then tClass = "Mage" end			if(tTemp == "pa") then tClass = "Paladin" end			if(tTemp == "pe") then tClass = "Priest" end			if(tTemp == "sa" or tTemp == "sm") then tClass = "Shaman" end			if(tTemp == "su" or tTemp == "ru") then tClass = "Rogue" end			if(tTemp == "te" or tTemp == "dt") then tClass = "DeathKnight" end						if(frame.classes[string.lower(tClass)] == nil) then frame.classes[string.lower(tClass)] = {} end			table.insert(frame.classes[string.lower(tClass)], tName)			frame.index[i] = tName			tIndex = (i - 1)%10 + 1						local tFriend = frame.addFriend(tName, tClass, tIndex)			tFriend.setButton({				"TOGGLE:FRIENDS",				tName,				"Interface\\AddOns\\MultiBot\\Icons\\class_" .. strlower(tClass) .. ".blp",				"/uninvite",				".playerbot bot add " .. tName,				"Left to show or hide Options | Right to dismiss " .. tName,				tClass .. " - " .. tLevel .. " - " .. tName,				tName			})						if(i > 10)			then tFriend:Hide()			else tFriend:Show()			end		end				-- FILTER --				if(frame.limit > 10) then			frame.select = MultiBot.newSelect(frame, 0, (frame.size + 2) * 11, MultiBot.config.filter, true).addOptions("none")			frame.browse = MultiBot.newSingle(frame, 0, (frame.size + 2) * 12, MultiBot.config.browse)		else			frame.select = MultiBot.newSelect(frame, 0, (frame.size + 2) * (tIndex + 1), MultiBot.config.filter)			frame.browse = MultiBot.newSingle(frame, 0, (frame.size + 2) * (tIndex + 2), MultiBot.config.browse)			frame.browse:Hide()		end				frame.doHide()		return frame	end		-- GET --		frame.getBotByIndex = function(pIndex)		if(frame.index[pIndex] == nil) then return nil end		return frame.friends[frame.index[pIndex]]	end		frame.getBotByName = function(pName)		return frame.friends[pName]	end		-- DO --		frame.doBrowse = function(pLimit)		if(pLimit ~= nil) then frame.limit = pLimit end				local tFilter = frame.select.action[7]		local tFriend = nil		local tTable = nil		local tIndex = 0				if(tFilter ~= "none")		then tTable = frame.classes[tFilter]		else tTable = frame.index		end				for key, value in pairs(frame.friends) do value:Hide() end				if(tTable == nil) then			frame.select.setPoint(0, (frame.size + 2) * 1)			frame.browse.setPoint(0, (frame.size + 2) * 2)			frame.browse:Hide()			return		end				if(frame.limit == 0) then			frame.limit = table.getn(tTable)			frame.from = 1			frame.to = 10						for i = 1, frame.limit do				tIndex = (i - 1)%10 + 1				tFriend = frame.friends[tTable[i]]				tFriend.setPoint(0, (frame.size + 2) * tIndex)				if(frame.from <= i and frame.to >= i)				then tFriend:Show()				else tFriend:Hide()				end			end						if(frame.limit < frame.to) then				frame.select.setPoint(0, (frame.size + 2) * (frame.limit + 1))				frame.browse.setPoint(0, (frame.size + 2) * (frame.limit + 2))			else				frame.select.setPoint(0, (frame.size + 2) * (frame.to + 1))				frame.browse.setPoint(0, (frame.size + 2) * (frame.to + 2))			end						if(frame.limit < 10) then				frame.browse:Hide()			else				frame.browse:Show()			end		else			local tFrom = frame.from + 10			local tTo = frame.to + 10						if(tFrom > frame.limit) then				tFrom = 1				tTo = 10			end						if(tTo > frame.limit) then				tTo = frame.limit			end						for i = 1, frame.limit do				tFriend = frame.friends[tTable[i]]								if(frame.from <= i and frame.to >= i) then					tFriend:Hide()				end								if(tFrom <= i and tTo >= i) then					tIndex = tIndex + 1					tFriend:Show()				end			end						frame.from = tFrom			frame.to = tTo						frame.select.setPoint(0, (frame.size + 2) * (tIndex + 1))			frame.browse.setPoint(0, (frame.size + 2) * (tIndex + 2))		end	end		frame.doCloseInventories = function(pName)		for key, value in pairs(frame.friends) do			if(value.name ~= pName and value.button.state == true) then				value.right.buttons["inventory"].setState(false)				value.inventory.doClose()			end		end	end		frame.doSummon = function()		for key, value in pairs(frame.friends) do			if(value.button.state == true) then				SendChatMessage("summon", "WHISPER", nil, key)			end		end	end		frame.doRefresh = function()		frame.doHide()		table.wipe(frame.friends)		table.wipe(frame.classes)		table.wipe(frame.index)		frame.setFriends()		frame.doShow()	end		frame.doHide = function()		for key, value in pairs(frame.friends) do value:Hide() end		frame.browse:Hide()		frame.select:Hide()	end		frame.doShow = function()		local tFilter = frame.select.action[7]		local tTable = nil				if(tFilter ~= "none")		then tTable = frame.classes[frame.select.action[7]]		else tTable = frame.index		end				for i = 1, table.getn(tTable) do			if(frame.from <= i and frame.to >= i)			then frame.friends[tTable[i]]:Show()			else frame.friends[tTable[i]]:Hide()			end		end				if(frame.limit > 10) then frame.browse:Show() end		frame.select:Show()	end		return frame.setFriends()endprint("AfterMultiBotFriends")